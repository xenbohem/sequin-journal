<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sequin Flip Prototype — Purple → Cornflower</title>
  <style>
    :root{
      --panel-width: 820px;
      --panel-height: 520px;
      --cols: 42;            /* tweak density */
      --rows: 24;
      --sequin-size: 18px;   /* diameter of each sequin */
      --gap: 2px;
      --base-dark: #2a0f3d;  /* deep purple base for gradient */
      --base-mid: #5b2bb0;   /* mid violet */
      --base-light: #a67ff9; /* luminous violet */
      --flip-blue: #93baf6;  /* cornflower-ish blue for flipped side */
      --glow: rgba(171,133,255,0.18);
      --sparkle: rgba(255,255,255,0.9);
      --perspective: 500px;
      --flip-duration: 220ms;
      --auto-unflip-ms: 1200;
    }

    body{
      font-family: Inter, system-ui, Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      background:
        radial-gradient(circle at 10% 10%, rgba(255,255,255,0.03), transparent 6%),
        linear-gradient(180deg, #0f0514 0%, #12061a 100%);
      margin:0;
      color:#eee;
    }

    .stage {
      width: calc(var(--panel-width));
      padding: 28px;
      border-radius: 12px;
      box-shadow:
        0 10px 30px rgba(0,0,0,0.6),
        0 0 40px rgba(90,40,150,0.08) inset;
      background: linear-gradient(145deg, var(--base-dark), var(--base-mid) 45%, var(--base-light) 100%);
    }

    .title {
      margin:0 0 12px 6px;
      font-weight:700;
      letter-spacing:0.6px;
      color: #f6eefe;
      text-shadow: 0 2px 8px rgba(90,20,140,0.45);
    }

    /* sequin panel container (3D space) */
    .panel {
      width: var(--panel-width);
      height: var(--panel-height);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      perspective: var(--perspective);
      background:
        radial-gradient(1200px 300px at 10% 20%, rgba(166,127,249,0.06), transparent 6%),
        linear-gradient(180deg, rgba(0,0,0,0.06), transparent 40%);
      box-shadow: inset 0 2px 30px rgba(255,255,255,0.02);
    }

    /* tiny overlay gradient for fairy vibe */
    .panel::after{
      content:"";
      position:absolute;
      left:0;right:0;top:0;bottom:0;
      pointer-events:none;
      background: linear-gradient(120deg, rgba(147,186,246,0.06), rgba(166,127,249,0.03));
      mix-blend-mode: screen;
    }

    /* grid that holds sequins */
    .grid {
      display: grid;
      width:100%;
      height:100%;
      grid-template-columns: repeat(var(--cols), minmax(0, 1fr));
      grid-template-rows: repeat(var(--rows), minmax(0, 1fr));
      gap: var(--gap);
      padding: 14px;
      box-sizing: border-box;
      align-items: center;
      justify-items: center;
    }

    .sequin {
      --size: var(--sequin-size);
      width: var(--size);
      height: var(--size);
      position: relative;
      transform-style: preserve-3d;
      transition: transform var(--flip-duration) ease;
      cursor: default;
      border-radius: 50%;
      display: inline-block;
      transform-origin: center;
      will-change: transform;
      box-shadow: 0 1px 2px rgba(0,0,0,0.35);
      -webkit-tap-highlight-color: transparent;
    }

    /* faces: front (purple) and back (cornflower-blue) */
    .sequin .face {
      position:absolute;
      inset:0;
      border-radius: 50%;
      backface-visibility: hidden;
      display:block;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
      overflow: hidden;
    }

    /* Front (purple side) */
    .sequin .front {
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,0.65), rgba(255,255,255,0.05) 8%),
        linear-gradient(160deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15)),
        conic-gradient(from 120deg at 50% 50%, rgba(255,255,255,0.06), rgba(255,255,255,0.00));
      /* main purple tint */
      background-color: var(--base-mid);
      transform: rotateY(0deg) translateZ(0.5px);
      border: 1px solid rgba(255,255,255,0.06);
      filter: saturate(1.05) contrast(1.02);
    }

    /* Back (flipped) side in cornflower blue */
    .sequin .back {
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,0.55), rgba(255,255,255,0.02) 8%),
        linear-gradient(160deg, rgba(255,255,255,0.04), rgba(0,0,0,0.12));
      background-color: var(--flip-blue);
      transform: rotateY(180deg) translateZ(0.5px);
      border: 1px solid rgba(255,255,255,0.06);
      filter: contrast(1.02) saturate(1.05);
    }

    /* the flip state (rotates the whole sequin) */
    .sequin.flipped {
      transform: rotateY(180deg) scale(1.02);
      transition: transform var(--flip-duration) cubic-bezier(.2,.9,.1,1);
    }

    /* occasional sparkle highlight (pseudo-element) */
    .sequin::before{
      content:"";
      position:absolute;
      left:50%; top:18%;
      width:30%;
      height:20%;
      transform: translateX(-50%);
      border-radius:50%;
      pointer-events:none;
      opacity:0.9;
      filter: blur(0.6px);
      background: radial-gradient(circle at 40% 40%, var(--sparkle), rgba(255,255,255,0.0) 60%);
      mix-blend-mode: screen;
    }

    /* when sequins are flipped, add a subtle glow */
    .sequin.flipped::after{
      content:"";
      position:absolute;
      inset: -2px;
      border-radius:50%;
      box-shadow: 0 0 8px rgba(147,186,246,0.22), 0 0 18px rgba(166,127,249,0.06);
      pointer-events:none;
      opacity:1;
    }

    /* small accessibility/helper UI */
    .controls {
      margin-top:10px;
      display:flex;
      gap:12px;
      align-items:center;
    }

    .hint {
      font-size:13px;
      color: #e9e5ff;
      opacity:0.9;
    }

    .btn {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.06);
      color:#fff;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
    }

  </style>
</head>
<body>
  <div class="stage">
    <h1 class="title">Sequin Panel Prototype — Violet → Cornflower flip</h1>

    <div class="panel" id="panel" aria-label="Sequin fabric panel">
      <div class="grid" id="grid"></div>
    </div>

    <div class="controls">
      <div class="hint">Move the mouse over the panel to brush the sequins. Click to reset.</div>
      <button class="btn" id="resetBtn">Reset</button>
    </div>
  </div>

  <script>
    // Config
    const cols = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols')) || 42;
    const rows = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--rows')) || 24;
    const grid = document.getElementById('grid');
    const panel = document.getElementById('panel');
    const resetBtn = document.getElementById('resetBtn');
    const brushRadius = 26;           // px radius of brush effect
    const autoUnflipMs = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--auto-unflip-ms')) || 1200;

    // create sequins
    const sequins = [];
    for (let r=0; r<rows; r++){
      for (let c=0; c<cols; c++){
        const el = document.createElement('div');
        el.className = 'sequin';
        // store grid coords
        el.dataset.r = r;
        el.dataset.c = c;

        // faces
        const front = document.createElement('span');
        front.className = 'face front';
        const back = document.createElement('span');
        back.className = 'face back';

        el.appendChild(front);
        el.appendChild(back);

        // track a timeout so each sequin can auto-unflip
        el._unflipTimeout = null;

        grid.appendChild(el);
        sequins.push(el);
      }
    }

    // helper: get center position of a sequin element
    function centerPos(el){
      const rect = el.getBoundingClientRect();
      return {
        x: rect.left + rect.width/2,
        y: rect.top + rect.height/2
      };
    }

    // flip a sequin (adds class & schedules unflip)
    function flipSequin(el){
      if (!el.classList.contains('flipped')){
        el.classList.add('flipped');
      }
      // clear previous timeout
      if (el._unflipTimeout) clearTimeout(el._unflipTimeout);
      // schedule unflip after delay
      el._unflipTimeout = setTimeout(()=> {
        el.classList.remove('flipped');
        el._unflipTimeout = null;
      }, autoUnflipMs);
    }

    // On mousemove over panel: flip sequins within brushRadius
    panel.addEventListener('mousemove', (ev) => {
      const mx = ev.clientX, my = ev.clientY;
      // optimize by checking bounding boxes (we could do spatial hashing for large grids)
      for (let i=0;i<sequins.length;i++){
        const s = sequins[i];
        const p = centerPos(s);
        const dx = p.x - mx;
        const dy = p.y - my;
        const d2 = dx*dx + dy*dy;
        if (d2 <= brushRadius*brushRadius){
          flipSequin(s);
        }
      }
    });

    // Also allow touch support: on touchmove translate touches into mouse-like flips
    panel.addEventListener('touchmove', (ev) => {
      ev.preventDefault();
      for (let t of ev.touches){
        const mx = t.clientX, my = t.clientY;
        for (let i=0;i<sequins.length;i++){
          const s = sequins[i];
          const p = centerPos(s);
          const dx = p.x - mx;
          const dy = p.y - my;
          if ((dx*dx + dy*dy) <= brushRadius*brushRadius){
            flipSequin(s);
          }
        }
      }
    }, {passive:false});

    // clicking resets quickly
    resetBtn.addEventListener('click', () => {
      sequins.forEach(s => {
        s.classList.remove('flipped');
        if (s._unflipTimeout) { clearTimeout(s._unflipTimeout); s._unflipTimeout = null; }
      });
    });

    // optional: when exiting panel, don't instantly unflip; let auto-unflip do the work
    panel.addEventListener('mouseleave', () => {
      // nothing required — sequins will auto-unflip
    });

    // make panel keyboard accessible: space/enter resets
    panel.tabIndex = 0;
    panel.addEventListener('keydown', (ev) => {
      if (ev.key === ' ' || ev.key === 'Enter'){
        resetBtn.click();
      }
    });

    // small accessibility: focus style for keyboard users
    panel.addEventListener('focus', ()=> panel.style.outline = '2px solid rgba(166,127,249,0.18)');
    panel.addEventListener('blur', ()=> panel.style.outline = '');
  </script>
</body>
</html>
